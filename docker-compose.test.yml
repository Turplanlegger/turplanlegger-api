version: '3.4'

services:
  turplanlegger-api:
    build:
      context: .
      dockerfile: ./test.Dockerfile
      args:
        - DATABASE_URI=${TP_DATABASE_URI:-postgresql://turadm:passord@turplanlegger-db:5432/turplanlegger?connect_timeout=10&application_name=turplanleggerapi}
        - BASE_URL=${TP_BASE_URL:-turplanlegger-api}
        - SECRET_KEY=${TP_SECRET_KEY:-hemmelig}
        - SECRET_KEY_ID=${TP_SECRET_KEY_ID:-1}
    container_name: turplanlegger-pytest
    hostname: turplanlegger-pytest
    depends_on:
      - turplanlegger-db
    networks:
      - turplanlegger-network

  turplanlegger-db:
    image: postgres:15.2-alpine
    container_name: turplanlegger-db
    hostname:  turplanlegger-db
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -d $${POSTGRES_DB} -U $${POSTGRES_USER}"]
      start_period: 20s
      interval: 30s
      retries: 5
      timeout: 5s
    environment:
      - POSTGRES_USER=turadm
      - POSTGRES_PASSWORD=passord
      - POSTGRES_DB=turplanlegger
    networks:
      - turplanlegger-network

networks:
  turplanlegger-network:
    name: turplanlegger-network
